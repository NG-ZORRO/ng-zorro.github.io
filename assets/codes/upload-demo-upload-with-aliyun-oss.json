{"highlightCode":"<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Component <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/core'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> NzUploadChangeParam<span class=\"token punctuation\">,</span> NzUploadFile <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'ng-zorro-antd/upload'</span><span class=\"token punctuation\">;</span>\n\n@<span class=\"token function\">Component</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  selector<span class=\"token punctuation\">:</span> <span class=\"token string\">'nz-demo-upload-upload-with-aliyun-oss'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token template-string\">template: <span class=\"token html\">`\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>nz-upload</span>\n      <span class=\"token attr-name\">nzName</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>file<span class=\"token punctuation\">\"</span></span>\n      <span class=\"token attr-name\">[(nzFileList)]</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>files<span class=\"token punctuation\">\"</span></span>\n      <span class=\"token attr-name\">[nzTransformFile]</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>transformFile<span class=\"token punctuation\">\"</span></span>\n      <span class=\"token attr-name\">[nzData]</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>getExtraData<span class=\"token punctuation\">\"</span></span>\n      <span class=\"token attr-name\">[nzAction]</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>mockOSSData.host<span class=\"token punctuation\">\"</span></span>\n      <span class=\"token attr-name\">(nzChange)</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>onChange($event)<span class=\"token punctuation\">\"</span></span>\n    <span class=\"token punctuation\">></span></span>\n      Photos:\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">nz-button</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">nz-icon</span> <span class=\"token attr-name\">nzType</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>upload<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span>\n        Click to Upload\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>nz-upload</span><span class=\"token punctuation\">></span></span>\n  `</span></span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">NzDemoUploadUploadWithAliyunOssComponent</span> <span class=\"token punctuation\">{</span>\n  files<span class=\"token punctuation\">:</span> NzUploadFile<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  mockOSSData <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    dir<span class=\"token punctuation\">:</span> <span class=\"token string\">'user-dir/'</span><span class=\"token punctuation\">,</span>\n    expire<span class=\"token punctuation\">:</span> <span class=\"token string\">'1577811661'</span><span class=\"token punctuation\">,</span>\n    host<span class=\"token punctuation\">:</span> <span class=\"token string\">'//www.mocky.io/v2/5cc8019d300000980a055e76'</span><span class=\"token punctuation\">,</span>\n    accessId<span class=\"token punctuation\">:</span> <span class=\"token string\">'c2hhb2RhaG9uZw=='</span><span class=\"token punctuation\">,</span>\n    policy<span class=\"token punctuation\">:</span> <span class=\"token string\">'eGl4aWhhaGFrdWt1ZGFkYQ=='</span><span class=\"token punctuation\">,</span>\n    signature<span class=\"token punctuation\">:</span> <span class=\"token string\">'ZGFob25nc2hhbw=='</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  transformFile <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">:</span> NzUploadFile<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> NzUploadFile <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> suffix <span class=\"token operator\">=</span> file<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">.</span><span class=\"token function\">lastIndexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> filename <span class=\"token operator\">=</span> Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> suffix<span class=\"token punctuation\">;</span>\n    file<span class=\"token punctuation\">.</span>url <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mockOSSData<span class=\"token punctuation\">.</span>dir <span class=\"token operator\">+</span> filename<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> file<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  getExtraData <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">:</span> NzUploadFile<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> accessId<span class=\"token punctuation\">,</span> policy<span class=\"token punctuation\">,</span> signature <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mockOSSData<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n      key<span class=\"token punctuation\">:</span> file<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">,</span>\n      OSSAccessKeyId<span class=\"token punctuation\">:</span> accessId<span class=\"token punctuation\">,</span>\n      policy<span class=\"token punctuation\">,</span>\n      Signature<span class=\"token punctuation\">:</span> signature\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">onChange</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">:</span> NzUploadChangeParam<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">void</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Aliyun OSS:'</span><span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">.</span>fileList<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n","rawCode":"import { Component } from '@angular/core';\n\nimport { NzUploadChangeParam, NzUploadFile } from 'ng-zorro-antd/upload';\n\n@Component({\n  selector: 'nz-demo-upload-upload-with-aliyun-oss',\n  template: `\n    <nz-upload\n      nzName=\"file\"\n      [(nzFileList)]=\"files\"\n      [nzTransformFile]=\"transformFile\"\n      [nzData]=\"getExtraData\"\n      [nzAction]=\"mockOSSData.host\"\n      (nzChange)=\"onChange($event)\"\n    >\n      Photos:\n      <button nz-button>\n        <span nz-icon nzType=\"upload\"></span>\n        Click to Upload\n      </button>\n    </nz-upload>\n  `\n})\nexport class NzDemoUploadUploadWithAliyunOssComponent {\n  files: NzUploadFile[] = [];\n  mockOSSData = {\n    dir: 'user-dir/',\n    expire: '1577811661',\n    host: '//www.mocky.io/v2/5cc8019d300000980a055e76',\n    accessId: 'c2hhb2RhaG9uZw==',\n    policy: 'eGl4aWhhaGFrdWt1ZGFkYQ==',\n    signature: 'ZGFob25nc2hhbw=='\n  };\n\n  transformFile = (file: NzUploadFile): NzUploadFile => {\n    const suffix = file.name.slice(file.name.lastIndexOf('.'));\n    const filename = Date.now() + suffix;\n    file.url = this.mockOSSData.dir + filename;\n\n    return file;\n  };\n\n  getExtraData = (file: NzUploadFile): {} => {\n    const { accessId, policy, signature } = this.mockOSSData;\n\n    return {\n      key: file.url,\n      OSSAccessKeyId: accessId,\n      policy,\n      Signature: signature\n    };\n  };\n\n  onChange(e: NzUploadChangeParam): void {\n    console.log('Aliyun OSS:', e.fileList);\n  }\n}\n"}
