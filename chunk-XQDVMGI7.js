import{d as $e,e as He}from"./chunk-PNYJKZIQ.js";import{Ca as Ne,Ea as Te,Fa as oe,G as F,Sb as G,Ta as Fe,Za as Re,ia as j,jb as Me,mb as Oe,n as xe,nb as Ze,ua as A,ub as We,va as R}from"./chunk-YWVGY2C2.js";import{Ac as J,Ba as k,Bc as ee,Ca as D,Cc as te,E as O,Ha as W,Hc as ke,Ib as Q,Jb as ze,Kb as we,Kc as De,La as U,Ma as fe,N as he,Ob as ye,Pb as $,Pc as Pe,Qa as ue,Vb as _e,Wb as Y,Xb as H,Yb as T,aa as me,ba as d,dc as L,ed as ie,f as E,fc as K,gc as q,hc as X,ia as pe,ic as g,id as Ee,ja as de,jc as _,kc as C,l as x,m as u,mb as ve,na as N,oa as Z,oc as V,qc as Ce,rb as v,rc as b,sb as m,sc as Se,tc as z,td as ne,uc as Ie,vc as be,ya as ge,z as B}from"./chunk-GBKJFEQZ.js";import{a as I}from"./chunk-EQDQRRRY.js";var Qe=["*"],Ye=["imgRef"],Ke=["imagePreviewWrapper"];function qe(i,a){if(i&1){let e=V();g(0,"div",13),b("click",function(t){k(e);let o=z();return D(o.onSwitchLeft(t))}),C(1,"nz-icon",14),_(),g(2,"div",15),b("click",function(t){k(e);let o=z();return D(o.onSwitchRight(t))}),C(3,"nz-icon",16),_()}if(i&2){let e=z();T("ant-image-preview-switch-left-disabled",e.index<=0),v(2),T("ant-image-preview-switch-right-disabled",e.index>=e.images.length-1)}}function Xe(i,a){if(i&1&&(g(0,"li",5),ke(1),_()),i&2){let e=z();v(),De("",e.index+1," / ",e.images.length,"")}}function Je(i,a){if(i&1){let e=V();g(0,"li",17),b("click",function(){let t=k(e).$implicit;return D(t.onClick())}),C(1,"span",18),_()}if(i&2){let e,n=a.$implicit,t=z();T("ant-image-preview-operations-operation-disabled",t.zoomOutDisabled&&n.type==="zoomOut"),v(),Y("nzType",n.icon)("nzRotate",(e=n.rotate)!==null&&e!==void 0?e:0)}}function et(i,a){if(i&1&&C(0,"img",20,1),i&2){let e=z().$implicit,n=z();H("width",e.width)("height",e.height)("transform",n.previewImageTransform),_e("src",n.sanitizerResourceUrl(e.src),ve)("srcset",e.srcset)("alt",e.alt)}}function tt(i,a){if(i&1&&$(0,et,2,9,"img",19),i&2){let e=a.$index,n=z();L(e===n.index?0:-1)}}var it=(()=>{class i{constructor(){this.nzScaleStep=null,this.images=[]}addImage(e){this.images.push(e)}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=Q({type:i,selectors:[["nz-image-group"]],inputs:{nzScaleStep:"nzScaleStep"},exportAs:["nzImageGroup"],ngContentSelectors:Qe,decls:1,vars:0,template:function(n,t){n&1&&(Ie(),be(0))},encapsulation:2,changeDetection:0})}}return i})(),Ge="image";function nt(i){let a={};return i.width<=i.clientWidth&&i.height<=i.clientHeight&&(a={x:0,y:0}),(i.width>i.clientWidth||i.height>i.clientHeight)&&(a={x:je(i.left,i.width,i.clientWidth),y:je(i.top,i.height,i.clientHeight)}),a}function ot(i){let a=i.getBoundingClientRect(),e=document.documentElement;return{left:a.left+(window.pageXOffset||e.scrollLeft)-(e.clientLeft||document.body.clientLeft||0),top:a.top+(window.pageYOffset||e.scrollTop)-(e.clientTop||document.body.clientTop||0)}}function st(){let i=document.documentElement.clientWidth,a=window.innerHeight||document.documentElement.clientHeight;return{width:i,height:a}}function je(i,a,e){let n=i+a,t=(a-e)/2,o=null;return a>e?(i>0&&(o=t),i<0&&n<e&&(o=-t)):(i<0||n>e)&&(o=i<0?t:-t),o}var M=class{constructor(){this.nzKeyboard=!0,this.nzNoAnimation=!1,this.nzMaskClosable=!0,this.nzCloseOnNavigation=!0}},Ae={x:0,y:0},ae=.5,at=1,rt=0,Be=(()=>{class i{get animationDisabled(){return this.config.nzNoAnimation??!1}get maskClosable(){let e=this.nzConfigService.getConfigForComponent(Ge)||{};return this.config.nzMaskClosable??e.nzMaskClosable??!0}constructor(e,n,t,o,c,l){this.ngZone=e,this.cdr=n,this.nzConfigService=t,this.config=o,this.destroy$=c,this.sanitizer=l,this._defaultNzZoom=at,this._defaultNzScaleStep=ae,this._defaultNzRotate=rt,this.images=[],this.index=0,this.isDragging=!1,this.visible=!0,this.animationStateChanged=new U,this.scaleStepMap=new Map,this.previewImageTransform="",this.previewImageWrapperTransform="",this.operations=[{icon:"close",onClick:()=>{this.onClose()},type:"close"},{icon:"zoom-in",onClick:()=>{this.onZoomIn()},type:"zoomIn"},{icon:"zoom-out",onClick:()=>{this.onZoomOut()},type:"zoomOut"},{icon:"rotate-right",onClick:()=>{this.onRotateRight()},type:"rotateRight"},{icon:"rotate-left",onClick:()=>{this.onRotateLeft()},type:"rotateLeft"},{icon:"swap",onClick:()=>{this.onHorizontalFlip()},type:"flipHorizontally"},{icon:"swap",onClick:()=>{this.onVerticalFlip()},type:"flipVertically",rotate:90}],this.zoomOutDisabled=!1,this.position=I({},Ae),this.closeClick=new U,this.document=Z(ne),this.zoom=this.config.nzZoom??this._defaultNzZoom,this.scaleStep=this.config.nzScaleStep??this._defaultNzScaleStep,this.rotate=this.config.nzRotate??this._defaultNzRotate,this.flipHorizontally=this.config.nzFlipHorizontally??!1,this.flipVertically=this.config.nzFlipVertically??!1,this.updateZoomOutDisabled(),this.updatePreviewImageTransform(),this.updatePreviewImageWrapperTransform()}ngOnInit(){j(this.imagePreviewWrapper.nativeElement,"mousedown").pipe(d(this.destroy$)).subscribe(()=>{this.isDragging=!0}),j(this.imagePreviewWrapper.nativeElement,"wheel").pipe(d(this.destroy$)).subscribe(e=>{this.ngZone.run(()=>this.wheelZoomEventHandler(e))}),j(this.document,"keydown").pipe(O(e=>e.keyCode===27),d(this.destroy$)).subscribe(()=>{this.ngZone.run(()=>{this.onClose(),this.markForCheck()})})}setImages(e,n){n&&(this.scaleStepMap=n),this.images=e,this.markForCheck()}switchTo(e){this.index=e,this.markForCheck()}next(){this.index<this.images.length-1&&(this.reset(),this.index++,this.updatePreviewImageTransform(),this.updatePreviewImageWrapperTransform(),this.updateZoomOutDisabled(),this.markForCheck())}prev(){this.index>0&&(this.reset(),this.index--,this.updatePreviewImageTransform(),this.updatePreviewImageWrapperTransform(),this.updateZoomOutDisabled(),this.markForCheck())}markForCheck(){this.cdr.markForCheck()}onClose(){this.visible=!1,this.closeClick.emit()}onZoomIn(){let e=this.scaleStepMap.get(this.images[this.index].src??this.images[this.index].srcset)??this.scaleStep;this.zoom+=e,this.updatePreviewImageTransform(),this.updateZoomOutDisabled()}onZoomOut(){if(this.zoom>1){let e=this.scaleStepMap.get(this.images[this.index].src??this.images[this.index].srcset)??this.scaleStep;this.zoom-=e,this.updatePreviewImageTransform(),this.updateZoomOutDisabled(),this.zoom<=1&&this.reCenterImage()}}onRotateRight(){this.rotate+=90,this.updatePreviewImageTransform()}onRotateLeft(){this.rotate-=90,this.updatePreviewImageTransform()}onSwitchLeft(e){e.preventDefault(),e.stopPropagation(),this.prev()}onSwitchRight(e){e.preventDefault(),e.stopPropagation(),this.next()}onHorizontalFlip(){this.flipHorizontally=!this.flipHorizontally,this.updatePreviewImageTransform()}onVerticalFlip(){this.flipVertically=!this.flipVertically,this.updatePreviewImageTransform()}wheelZoomEventHandler(e){e.preventDefault(),e.stopPropagation(),this.handlerImageTransformationWhileZoomingWithMouse(e,e.deltaY),this.handleImageScaleWhileZoomingWithMouse(e.deltaY),this.updatePreviewImageWrapperTransform(),this.updatePreviewImageTransform(),this.markForCheck()}onAnimationStart(e){this.animationStateChanged.emit(e)}onAnimationDone(e){this.animationStateChanged.emit(e)}onDragEnd(e){this.isDragging=!1;let n=this.imageRef.nativeElement.offsetWidth*this.zoom,t=this.imageRef.nativeElement.offsetHeight*this.zoom,{left:o,top:c}=ot(this.imageRef.nativeElement),{width:l,height:f}=st(),S=this.rotate%180!==0,y=nt({width:S?t:n,height:S?n:t,left:o,top:c,clientWidth:l,clientHeight:f});F(y.x)||F(y.y)?this.position=I(I({},this.position),y):!F(y.x)&&!F(y.y)&&(this.position={x:e.source.getFreeDragPosition().x,y:e.source.getFreeDragPosition().y})}sanitizerResourceUrl(e){return this.sanitizer.bypassSecurityTrustResourceUrl(e)}updatePreviewImageTransform(){this.previewImageTransform=`scale3d(${this.zoom*(this.flipHorizontally?-1:1)}, ${this.zoom*(this.flipVertically?-1:1)}, 1) rotate(${this.rotate}deg)`}updatePreviewImageWrapperTransform(){this.previewImageWrapperTransform=`translate3d(${this.position.x}px, ${this.position.y}px, 0)`}updateZoomOutDisabled(){this.zoomOutDisabled=this.zoom<=1}handlerImageTransformationWhileZoomingWithMouse(e,n){let t,o=this.imageRef.nativeElement,l=getComputedStyle(o).transform.match(/matrix.*\((.+)\)/);l?t=+l[1].split(", ")[0]:t=this.zoom;let f=(e.clientX-o.getBoundingClientRect().x)/t,S=(e.clientY-o.getBoundingClientRect().y)/t,w=n<0?this.scaleStep/2:-this.scaleStep/2;this.position.x+=-f*w*2+o.offsetWidth*w,this.position.y+=-S*w*2+o.offsetHeight*w}handleImageScaleWhileZoomingWithMouse(e){this.isZoomedInWithMouseWheel(e)?this.onZoomIn():this.onZoomOut(),this.zoom<=1&&this.reCenterImage()}isZoomedInWithMouseWheel(e){return e<0}reset(){this.zoom=this.config.nzZoom??this._defaultNzZoom,this.scaleStep=this.config.nzScaleStep??this._defaultNzScaleStep,this.rotate=this.config.nzRotate??this._defaultNzRotate,this.flipHorizontally=!1,this.flipVertically=!1,this.reCenterImage()}reCenterImage(){this.position=I({},Ae)}static{this.\u0275fac=function(n){return new(n||i)(m(fe),m(ie),m(A),m(M),m(G),m(xe))}}static{this.\u0275cmp=Q({type:i,selectors:[["nz-image-preview"]],viewQuery:function(n,t){if(n&1&&(J(Ye,5),J(Ke,7)),n&2){let o;ee(o=te())&&(t.imageRef=o.first),ee(o=te())&&(t.imagePreviewWrapper=o.first)}},hostAttrs:[1,"ant-image-preview-root"],hostVars:6,hostBindings:function(n,t){n&1&&Se("@fadeMotion.start",function(c){return t.onAnimationStart(c)})("@fadeMotion.done",function(c){return t.onAnimationDone(c)}),n&2&&(Ce("@.disabled",t.config.nzNoAnimation)("@fadeMotion",t.visible?"enter":"leave"),H("z-index",t.config.nzZIndex),T("ant-image-preview-moving",t.isDragging))},exportAs:["nzImagePreview"],features:[Pe([G])],decls:17,vars:5,consts:[["imagePreviewWrapper",""],["imgRef",""],[1,"ant-image-preview-mask"],[1,"ant-image-preview-operations-wrapper"],[1,"ant-image-preview-operations"],[1,"ant-image-preview-operations-progress"],[1,"ant-image-preview-operations-operation",3,"ant-image-preview-operations-operation-disabled"],["tabindex","-1",1,"ant-image-preview-wrap",3,"click"],["role","dialog","aria-modal","true",1,"ant-image-preview"],["tabindex","0","aria-hidden","true",1,"ant-image-preview-focus-trap"],[1,"ant-image-preview-content"],[1,"ant-image-preview-body"],["cdkDrag","",1,"ant-image-preview-img-wrapper",3,"cdkDragEnded","cdkDragFreeDragPosition"],[1,"ant-image-preview-switch-left",3,"click"],["nzType","left","nzTheme","outline"],[1,"ant-image-preview-switch-right",3,"click"],["nzType","right","nzTheme","outline"],[1,"ant-image-preview-operations-operation",3,"click"],["nz-icon","","nzTheme","outline",1,"ant-image-preview-operations-icon",3,"nzType","nzRotate"],["cdkDragHandle","",1,"ant-image-preview-img",3,"width","height","transform"],["cdkDragHandle","",1,"ant-image-preview-img"]],template:function(n,t){if(n&1){let o=V();C(0,"div",2),g(1,"div",3),$(2,qe,4,4),g(3,"ul",4),$(4,Xe,2,2,"li",5),q(5,Je,2,4,"li",6,K),_()(),g(7,"div",7),b("click",function(l){return k(o),D(t.maskClosable&&l.target===l.currentTarget&&t.onClose())}),g(8,"div",8),C(9,"div",9),g(10,"div",10)(11,"div",11)(12,"div",12,0),b("cdkDragEnded",function(l){return k(o),D(t.onDragEnd(l))}),q(14,tt,1,1,null,null,K),_()()(),C(16,"div",9),_()()}n&2&&(v(2),L(t.images.length>1?2:-1),v(2),L(t.images.length>1?4:-1),v(),X(t.operations),v(7),H("transform",t.previewImageWrapperTransform),Y("cdkDragFreeDragPosition",t.position),v(2),X(t.images))},dependencies:[Te,Ne,$e,He],encapsulation:2,data:{animation:[We]},changeDetection:0})}}return i})(),re=class{constructor(a,e,n){this.previewInstance=a,this.config=e,this.overlayRef=n,this.destroy$=new E,n.keydownEvents().pipe(O(t=>this.config.nzKeyboard&&(t.keyCode===27||t.keyCode===37||t.keyCode===39)&&!Re(t))).subscribe(t=>{t.preventDefault(),t.keyCode===27&&a.onClose(),t.keyCode===37&&this.prev(),t.keyCode===39&&this.next()}),n.detachments().subscribe(()=>{this.overlayRef.dispose()}),a.closeClick.pipe(he(1),me(()=>a.animationStateChanged),O(t=>t.phaseName==="done"),d(this.destroy$)).subscribe(()=>{this.close()})}switchTo(a){this.previewInstance.switchTo(a)}next(){this.previewInstance.next()}prev(){this.previewInstance.prev()}close(){this.destroy$.next(),this.overlayRef.dispose()}},Ue=(()=>{class i{constructor(e,n,t,o){this.overlay=e,this.injector=n,this.nzConfigService=t,this.directionality=o}preview(e,n,t){return this.display(e,n,t)}display(e,n,t){let o=I(I({},new M),n??{}),c=this.createOverlay(o),l=this.attachPreviewComponent(c,o);l.setImages(e,t);let f=new re(l,o,c);return l.previewRef=f,f}attachPreviewComponent(e,n){let t=W.create({parent:this.injector,providers:[{provide:Oe,useValue:e},{provide:M,useValue:n}]}),o=new Fe(Be,null,t);return e.attach(o).instance}createOverlay(e){let n=this.nzConfigService.getConfigForComponent(Ge)||{},t=new Me({scrollStrategy:this.overlay.scrollStrategies.block(),positionStrategy:this.overlay.position().global(),disposeOnNavigation:e.nzCloseOnNavigation??n.nzCloseOnNavigation??!0,direction:e.nzDirection||n.nzDirection||this.directionality.value});return this.overlay.create(t)}static{this.\u0275fac=function(n){return new(n||i)(N(Ze),N(W),N(A),N(oe))}}static{this.\u0275prov=pe({token:i,factory:i.\u0275fac})}}return i})(),lt="image",Wt=(()=>{let i,a=[],e=[],n,t=[],o=[],c,l=[],f=[],S,w=[],y=[];return class le{static{let r=typeof Symbol=="function"&&Symbol.metadata?Object.create(null):void 0;i=[R()],n=[R()],c=[R()],S=[R()],x(null,null,i,{kind:"field",name:"nzDisablePreview",static:!1,private:!1,access:{has:s=>"nzDisablePreview"in s,get:s=>s.nzDisablePreview,set:(s,h)=>{s.nzDisablePreview=h}},metadata:r},a,e),x(null,null,n,{kind:"field",name:"nzFallback",static:!1,private:!1,access:{has:s=>"nzFallback"in s,get:s=>s.nzFallback,set:(s,h)=>{s.nzFallback=h}},metadata:r},t,o),x(null,null,c,{kind:"field",name:"nzPlaceholder",static:!1,private:!1,access:{has:s=>"nzPlaceholder"in s,get:s=>s.nzPlaceholder,set:(s,h)=>{s.nzPlaceholder=h}},metadata:r},l,f),x(null,null,S,{kind:"field",name:"nzScaleStep",static:!1,private:!1,access:{has:s=>"nzScaleStep"in s,get:s=>s.nzScaleStep,set:(s,h)=>{s.nzScaleStep=h}},metadata:r},w,y),r&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:r})}get previewable(){return!this.nzDisablePreview&&this.status!=="error"}constructor(r,s,h,P,ce){this.nzConfigService=r,this.elementRef=s,this.nzImageService=h,this.cdr=P,this.directionality=ce,this._nzModuleName=lt,this.nzSrc="",this.nzSrcset="",this.nzDisablePreview=u(this,a,!1),this.nzFallback=(u(this,e),u(this,t,null)),this.nzPlaceholder=(u(this,o),u(this,l,null)),this.nzScaleStep=(u(this,f),u(this,w,null)),this.dir=u(this,y),this.status="normal",this.backLoadDestroy$=new E,this.destroy$=new E,this.document=Z(ne),this.parentGroup=Z(it,{optional:!0})}ngOnInit(){this.backLoad(),this.parentGroup&&this.parentGroup.addImage(this),this.directionality&&(this.directionality.change?.pipe(d(this.destroy$)).subscribe(r=>{this.dir=r,this.cdr.detectChanges()}),this.dir=this.directionality.value)}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}onPreview(){if(this.previewable)if(this.parentGroup){let r=this.parentGroup.images.filter(p=>p.previewable),s=r.map(p=>({src:p.nzSrc,srcset:p.nzSrcset})),h=r.findIndex(p=>this===p),P=new Map;r.forEach(p=>{P.set(p.nzSrc??p.nzSrcset,p.nzScaleStep??this.parentGroup.nzScaleStep??this.nzScaleStep??ae)}),this.nzImageService.preview(s,{nzDirection:this.dir},P).switchTo(h)}else{let r=[{src:this.nzSrc,srcset:this.nzSrcset}];this.nzImageService.preview(r,{nzDirection:this.dir,nzScaleStep:this.nzScaleStep??ae})}}getElement(){return this.elementRef}ngOnChanges(r){let{nzSrc:s}=r;s&&(this.getElement().nativeElement.src=s.currentValue,this.backLoad())}backLoad(){this.backLoadImage=this.document.createElement("img"),this.backLoadImage.src=this.nzSrc,this.backLoadImage.srcset=this.nzSrcset,this.status="loading",this.backLoadDestroy$.next(),this.backLoadDestroy$.complete(),this.backLoadDestroy$=new E,this.backLoadImage.complete?(this.status="normal",this.getElement().nativeElement.src=this.nzSrc,this.getElement().nativeElement.srcset=this.nzSrcset):(this.nzPlaceholder?(this.getElement().nativeElement.src=this.nzPlaceholder,this.getElement().nativeElement.srcset=""):(this.getElement().nativeElement.src=this.nzSrc,this.getElement().nativeElement.srcset=this.nzSrcset),B(this.backLoadImage,"load").pipe(d(this.backLoadDestroy$),d(this.destroy$)).subscribe(()=>{this.status="normal",this.getElement().nativeElement.src=this.nzSrc,this.getElement().nativeElement.srcset=this.nzSrcset}),B(this.backLoadImage,"error").pipe(d(this.backLoadDestroy$),d(this.destroy$)).subscribe(()=>{this.status="error",this.nzFallback&&(this.getElement().nativeElement.src=this.nzFallback,this.getElement().nativeElement.srcset="")}))}static{this.\u0275fac=function(s){return new(s||le)(m(A),m(ue),m(Ue),m(ie),m(oe))}}static{this.\u0275dir=we({type:le,selectors:[["img","nz-image",""]],hostBindings:function(s,h){s&1&&b("click",function(){return h.onPreview()})},inputs:{nzSrc:"nzSrc",nzSrcset:"nzSrcset",nzDisablePreview:[2,"nzDisablePreview","nzDisablePreview",Ee],nzFallback:"nzFallback",nzPlaceholder:"nzPlaceholder",nzScaleStep:"nzScaleStep"},exportAs:["nzImage"],features:[ye,ge]})}}})(),$t=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=ze({type:i})}static{this.\u0275inj=de({providers:[Ue],imports:[Be]})}}return i})();export{it as a,Ue as b,Wt as c,$t as d};
